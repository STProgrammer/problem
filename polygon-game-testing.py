
# Example 1
input_str1 = '''4 2
0 0
1 0
1 1
0 1
0 0 1 1
0.5 0 0.5 1
'''

input_str2 = '''5 4
0 0
1 0
2 1
1 2
0 2
0 0 2 0
2 0 2 2
2 2 0 2
0 2 0 0
'''

input_str3 = '''6 3
0 0
1 0
2 1
2 2
1 3
0 2
0 0 2 2
1 0 1 3
0 2 2 0
'''

input_str4 = '''4 4
0 0
2 0
2 2
0 2
0 0 2 0
2 0 2 2
2 2 0 2
0 2 0 0
'''

input_str5 = '''5 5
0 0
2 0
2 2
1 3
0 2
0 0 2 1
2 1 0 2
0 2 1 0
1 0 2 1
2 1 1 2
'''

input_str6 = '''6 4
0 0
2 0
3 1
2 2
1 2
0 1
0 0 3 1
3 1 2 2
2 2 0 1
0 1 1 2
'''

input_str7 = '''5 6
0 0
2 0
2 2
1 3
0 2
0 0 2 1
2 1 0 2
0 2 1 0
1 0 2 1
2 1 1 2
1 2 0 0
'''

input_str8 = '''7 5
0 0
1 0
2 1
3 0
4 2
3 3
0 2
0 0 2 1
2 1 0 2
0 2 1 0
1 0 3 3
2 1 4 2
'''

input_str9 = '''5 5
0 0
1 0
2 1
1 2
0 2
0.2344324234 0.43324324234 2.1223123 0.32124124324
2.122231247 0.5434352343 2.433457877225 2.23467893423
2.432423543546 2.00005422003 0.0009900122123 2.4667888212
0.99999999001 2.00989002323123 0 0
1 0 1.088008399300002 2.0000099000991111009
'''

input_str10 = '''8 7
0 0
2 0
3 1
4 2
4 4
3 5
1 5
0 4
0 0 2 1
2 1 0 2
0 2 2 4
2 4 0 4
0 4 1 5
1 5 3 5
3 5 4 4
'''

input_str11 = '''6 6
0 1
1 0
3 0
4 1
4 3
0 3
0.5 0.5 3.5 0.5
0.0 1.0 4.0 1.0
0.0 2.0 4.0 2.0
0.0 2.5 4.0 2.5
1.0 0.0 1.0 3.0
3.0 0.0 3.0 3.0
'''


input_str12 = '''7 6
0 0
2 0
3 1
4 2
4 3
2 4
0 3
0 0 4 2
4 1 2 4
4 3 0 3
0 3 2 0
2 0 4 3
4 3 2 4
'''


input_str13 = '''
25 50
23 44
24 47
25 49
27 52
28 53
31 55
33 56
36 57
40 58
44 57
47 56
49 55
52 53
53 52
55 49
56 47
57 44
58 40
57 36
56 33
55 31
53 28
52 27
49 25
47 24
56.64534672702648 34.93604018107942 44.88378003862929 56.705406653790234
24.203811717201233 47.407623434402474 57.075507329856606 36.30202931942643
53.773690889325835 29.16053633398876 50.321015902979696 54.11932273134687
56.57547894438971 45.27356316683087 57.059255400725505 36.23702160290202
37.73409686700131 31.721585944165575 35.10344339346007 56.70114779782003
55.483816260019225 31.967632520038457 37.027200113286696 32.310666572261084
54.097608085522864 29.646412128284297 50.08993680480811 54.27337546346126
55.81896834711587 32.637936694231755 23.38419099032341 45.15257297097023
37.804388647937444 57.451097161984364 48.38364243700259 24.6918212185013
47.08560583740816 24.04280291870408 45.32256032175777 56.559146559414074
27.8393270903783 52.8393270903783 48.94364135809159 55.02817932095421
53.37131139964893 28.5569670994734 52.55109051220336 27.551090512203366
46.85656327758017 56.04781224080661 57.300042534218264 42.79982986312695
31.143804545042272 55.071902272521136 27.47782519526492 52.47782519526492
30.81360070665515 54.87573380443676 45.86480341810997 56.37839886063001
50.739639239694 53.84024050687067 57.858695421189424 39.43478168475772
56.90172327191148 44.294830184265564 24.649189312181043 48.29837862436209
53.05535952825723 28.08303929238584 27.087266931087232 52.087266931087235
55.3433098053988 48.31338038920239 27.926533595800038 52.92653359580004
23.653121150643152 45.95936345192946 27.741050197356348 52.741050197356344
54.74395365297513 30.615930479462698 43.396726077278494 57.15081848068038
52.29599932121448 52.70400067878551 48.29860650889725 24.649303254448625
31.631462541973598 55.3157312709868 56.98724005953928 44.038279821382154
24.159087285089687 47.31817457017937 48.09984013670456 55.45007993164772
48.526371687566574 55.23681415621671 57.25472737881469 37.01890951525877
53.174590623299906 28.261885934949863 23.82544400100519 46.47633200301557
23.911440141897323 46.73432042569197 52.818435393988 27.818435393987997
26.091912671019927 50.6378690065299 49.56466333526396 25.376442223509304
49.52622375082598 25.350815833883985 56.839855439904085 44.48043368028773
52.07562874819762 27.07562874819762 47.47423594286056 55.76288202856972
57.09428042203955 36.3771216881582 51.688152280835624 53.20789847944292
28.656885993075612 53.43792399538374 32.64680840967906 35.96099299193412
57.51772714605617 41.92909141577533 52.16311242157493 52.83688757842507
36.23306880571464 32.972442661904466 39.87519160055673 57.96879790013919
27.428678677282456 52.428678677282456 55.7682467535467 47.46350649290661
52.1130105080879 27.113010508087903 53.4318006884392 51.3522989673412
51.349566793524744 26.566377862349835 57.409719603123435 37.63887841249375
23.145924887165357 44.43777466149607 35.36772547420126 56.78924182473375
57.34068398281991 37.36273593127963 46.34556269676323 24.545364419363974
42.166345134745555 57.458413716313615 57.799086432269874 39.19634572907952
48.15566698649541 24.577833493247706 35.97445940951082 33.187950492074314
43.168451033730584 27.19295747189118 55.074825452374114 31.14965090474822
56.27156598228308 46.185302053150764 54.76378690153331 49.35431964770004
57.385986872491216 42.45605251003512 26.090313302740824 50.63546995411123
32.247632910094055 55.62381645504703 55.534595223156344 32.06919044631269
55.684304792773176 32.368609585546366 45.6434015064594 56.45219949784687
24.415527097262128 42.82039408561489 47.16070545887587 24.080352729437934
42.99926469848483 57.25018382537879 33.989692967726505 56.32989765590884
25.49889613612264 49.74834420418396 40.32060407775751 57.919848980560616
33.774269278740505 35.021442267716246 48.07765949758054 24.53882974879027
'''


input_strings = [input_str1, input_str2, input_str3, input_str4, input_str5, input_str6, 
                 input_str7, input_str8, input_str9, input_str10, input_str11, input_str12, 
                 input_str13]


def parse_input(input_str):
    input_lines = input_str.strip().split('\n')
    N, M = map(int, input_lines[0].split())
    # print(f"N: {N}, M: {M}")
    polygon = [tuple(map(float, line.split())) for line in input_lines[1:N+1]]
    lines = []
    for line in input_lines[N+1:]:
        line_points = tuple(map(float, line.split()))
        lines.append([(line_points[0], line_points[1]), (line_points[2], line_points[3])])
    # print(f"Lines: {len(lines)}")
    # print(f"Polygon: {len(polygon)}")
    return polygon, lines



def line_intersection(line1, line2, epsilon=1e-9):
    x1, y1 = line1[0]
    x2, y2 = line1[1]
    x3, y3 = line2[0]
    x4, y4 = line2[1]

    # Denominator for the intersection point formulas
    denom = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4)
    if abs(denom) < epsilon:
        return None  # Lines are parallel or coincident

    # Numerator calculations for intersection point (Px, Py)
    Px_num = (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4)
    Py_num = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4)
    Px = Px_num / denom
    Py = Py_num / denom
    intersection_point = (Px, Py)

    # Helper function to check if a point is on a segment
    def is_point_on_segment(P, A, B, epsilon=1e-9):
        x, y = P
        x1, y1 = A
        x2, y2 = B
        # Collinearity check
        cross_product = (x2 - x1) * (y - y1) - (y2 - y1) * (x - x1)
        if abs(cross_product) > epsilon:
            return False
        # Bound check for being within segment endpoints
        if min(x1, x2) - epsilon <= x <= max(x1, x2) + epsilon and \
           min(y1, y2) - epsilon <= y <= max(y1, y2) + epsilon:
            return True
        return False

    # Verify if the intersection point lies on both segments
    if is_point_on_segment(intersection_point, line1[0], line1[1]) and is_point_on_segment(intersection_point, line2[0], line2[1]):
        return intersection_point
    else:
        return None  # Intersection point is outside the segments








def divide_polygon_by_line(polygon, line):
    
    points = set()
    modified_polygon = polygon.copy()
    # print("Original polygon:", polygon)
    plen = len(polygon)
    for i in range(plen-1):
        side = polygon[i:i+2]
        # print("Side: " ,side)
        intersect = line_intersection(side, line)
        # print(f"Side: {side}, and line {line}")
        if intersect:
            # print(f"Side: {side}, and line {line} intersect at {intersect}")
            if intersect not in modified_polygon:
                index = modified_polygon.index(polygon[i]) + 1
                modified_polygon.insert(index, intersect)
            points.add(intersect)
        
    intersect = line_intersection((polygon[0], polygon[-1]), line)
    if intersect:
       # print("Side: ",side, " and line " ,line)
        if intersect not in modified_polygon:
            modified_polygon.insert(0, intersect)
        points.add(intersect)
    
   # print("polygon:", polygon)
    # print("modified polygon: ", modified_polygon)
    
    points = list(points)
    # print("Points: ", points)
    


    if len(points) > 1:    
        #Construct first polygon
        index1 = modified_polygon.index(points[0])
        index2 = modified_polygon.index(points[1])
        
        if index1 < index2:
            polygon1 = modified_polygon[index1:index2+1]
            polygon2 = modified_polygon[index2:] + modified_polygon[:index1+1]
        else:
            polygon1 = modified_polygon[index1:] + modified_polygon[:index2+1]
            polygon2 = modified_polygon[index2:index1+1]
        
        # print("Polygon1: ", polygon1)
        # print("Polygon2: ", polygon2)
        return polygon1, polygon2
    else:
        return None, None


count = 0
count2 = 0



def divide_polygon_by_lines(polygon, lines):
    global count
    polsToReturn = [polygon]
    #print(polygon)
    for line in lines:
        polsToDivide = polsToReturn.copy()
        polsToReturn.clear()
        # print(f"PolsToDivide: {len(polsToDivide)}")
        # print(f"Line: {line}")
        for pol in polsToDivide:
            #print(f"polygon: {pol}")
            pol1, pol2 = divide_polygon_by_line(pol, line)
            #print(f"pol1: {pol1}")
            #print(f"pol2: {pol2}")
            if pol1 and pol2:
                count += 1
                polsToReturn.append(pol1)
                polsToReturn.append(pol2)
            else:
                polsToReturn.append(pol)
            #print("Nr of pols to return", len(polsToReturn))
            #print("Pol ", pol)
            #print("Line ", line)
            #print("Pol1 ", pol1)
            #print("Pol2 ", pol2)
    return polsToReturn



def polygon_area(vertices):
    n = len(vertices)
    area = 0.0
    for i in range(n):
        x1, y1 = vertices[i]
        x2, y2 = vertices[(i + 1) % n]
        area += (x1 * y2 - x2 * y1)
    return abs(area) / 2.0
    




# Find all vertices

def print_largest_area(polygon, lines):
    polygons = divide_polygon_by_lines(polygon, lines)
    areas = []
    #print("polygons: ", polygons)
    for pol in polygons:
        areas.append(polygon_area(pol))
    #print("Areas: ", areas)
    print(f"nr of areas: {len(areas)}")
    print(max(areas))
    #print(f"divide count: {count}")
 
ex = 0

for input_str in input_strings:
    ex += 1
    #print("Example: ", ex)
    polygon, lines = parse_input(input_str)
    print_largest_area(polygon, lines)






